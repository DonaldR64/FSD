

                let damage = parseInt(defender.token.get("bar3_value"));
                damage = Math.max(0,damage - totalHits);
                defender.token.set("bar3_value",damage);
                if (damage === 0) {
                    outputCard.body.push(defender.name + " was Destroyed!");
                } else {
                    _.each(keys,key => {
                        let damage = combatArray.statDamage[key];
                        if (damage > 0) {
                            let num = parseInt(defender[key]);
                            let keyMax = key + "Max";
                            let max = parseInt(defender[keyMax]);
                            if (isNaN(max)) {max = 0}; //will be X in sheet?
                            num = Math.max(0,num - damage);
                            defender[key] = num;

                            AttributeSet(defender.charID,key,num);
                            if (num === 0 && max > 0) {
                                if (key === "mobility") {
                                    outputCard.body.push(defender.name + " is Immobilized");
    //Status markers here
                                }
                                if (key === "firepower") {
                                    outputCard.body.push(defender.name + " is Disarmed");
    //Status markers here
                                }
                                if (key === "armour") {
                                    outputCard.body.push(defender.name + " is Destroyed");
//Destroy
                                }
                                if (key === "defence") {
                                    outputCard.body.push(defender.name + " is Deactivated");
    //Status markers here
                                }
                            }



                        }                        
                    })


                }




            }